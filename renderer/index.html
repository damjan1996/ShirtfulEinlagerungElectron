<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' 'unsafe-inline' 'unsafe-eval';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdnjs.cloudflare.com;
        media-src 'self' blob: data: mediastream:;
        connect-src 'self' blob: data:;
        img-src 'self' blob: data: https:;
        style-src 'self' 'unsafe-inline';
    ">
    <title>RFID Wareneinlagerung - Shirtful</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- Header -->
<header class="main-header">
    <div class="header-content">
        <div class="company-info">
            <h1 class="app-title">ğŸ“¦ Wareneinlagerung</h1>
            <div class="company-name">Shirtful GmbH</div>
        </div>

        <div class="system-status">
            <div class="status-indicator" id="systemStatus">
                <div class="status-dot"></div>
                <span class="status-text">System wird gestartet...</span>
            </div>
            <div class="current-time" id="currentTime">--:--:--</div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <!-- Login Bereich -->
    <section class="login-section" id="loginSection">
        <div class="login-card">
            <div class="login-icon">ğŸ·ï¸</div>
            <h2>RFID-Tag scannen</h2>
            <p>Halten Sie Ihren RFID-Tag an den Scanner</p>
            <div class="login-status" id="loginStatus">
                <div class="pulse-animation"></div>
                Bereit zum Scannen...
            </div>
            <div class="login-info">
                <p>ğŸ’¡ Mehrere Mitarbeiter kÃ¶nnen gleichzeitig arbeiten</p>
                <p>ğŸ”„ Erneutes Scannen startet Ihre Session neu</p>
            </div>
        </div>
    </section>

    <!-- Arbeitsbereich (nur sichtbar wenn Benutzer angemeldet) -->
    <section class="workspace" id="workspace" style="display: none;">

        <!-- Aktive Benutzer Sidebar -->
        <div class="users-sidebar">
            <div class="sidebar-header">
                <h3>ğŸ‘¥ Aktive Mitarbeiter</h3>
                <span class="user-count" id="activeUserCount">0</span>
            </div>
            <div class="users-list" id="activeUsersList">
                <!-- Dynamisch gefÃ¼llte Benutzer-Liste -->
            </div>
        </div>

        <!-- Hauptarbeitsbereich -->
        <div class="main-work-area">
            <!-- AusgewÃ¤hlter Benutzer Info -->
            <div class="selected-user-panel" id="selectedUserPanel" style="display: none;">
                <div class="user-info">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <h3 class="user-name" id="selectedUserName">Kein Benutzer ausgewÃ¤hlt</h3>
                        <div class="user-session-info">
                            <span class="session-time" id="selectedSessionTime">00:00:00</span>
                            <span class="session-scans">â€¢ <span id="selectedSessionScans">0</span> Scans</span>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="logout-btn" id="selectedUserLogout" title="Abmelden">
                            <span>ğŸ”“</span>
                            Abmelden
                        </button>
                    </div>
                </div>
            </div>

            <!-- QR-Scanner Bereich -->
            <div class="scanner-section">
                <div class="scanner-header">
                    <h3>ğŸ“¸ QR-Code Scanner</h3>
                    <div class="scanner-info-bar">
                        <span id="scannerUserInfo">WÃ¤hlen Sie einen Mitarbeiter aus</span>
                    </div>
                    <div class="scanner-controls">
                        <button class="btn-primary" id="startScannerBtn">
                            ğŸ“¹ Scanner starten
                        </button>
                        <button class="btn-secondary" id="stopScannerBtn" style="display: none;">
                            â¹ï¸ Scanner stoppen
                        </button>
                    </div>
                </div>

                <!-- Kamera-Vorschau -->
                <div class="camera-container" id="cameraContainer">
                    <video id="scannerVideo" autoplay playsinline muted></video>
                    <div class="scanner-overlay">
                        <div class="scanner-frame"></div>
                        <div class="scan-target">
                            <div class="corner tl"></div>
                            <div class="corner tr"></div>
                            <div class="corner bl"></div>
                            <div class="corner br"></div>
                        </div>
                    </div>
                    <div class="camera-status" id="cameraStatus">
                        <div class="status-icon">ğŸ“·</div>
                        <div class="status-text">Klicken Sie "Scanner starten"</div>
                    </div>
                </div>
                <canvas id="scannerCanvas" style="display: none;"></canvas>

                <!-- Scanner-Info -->
                <div class="scanner-info">
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value" id="scannerStatusText">Bereit</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Letzter Scan:</span>
                        <span class="info-value" id="lastScanTime">-</span>
                    </div>
                </div>
            </div>

            <!-- QR-Scans Ãœbersicht -->
            <div class="recent-scans-section">
                <div class="scans-header">
                    <h3>ğŸ“‹ QR-Scans</h3>
                    <div class="scans-controls">
                        <button class="btn-secondary btn-small" id="clearScansBtn">ğŸ—‘ï¸ Leeren</button>
                        <button class="btn-secondary btn-small" id="refreshScansBtn">ğŸ”„ Aktualisieren</button>
                    </div>
                </div>

                <!-- Aktueller Scan -->
                <div class="current-scan-display" id="currentScanDisplay" style="display: none;">
                    <div class="current-scan-header">
                        <span class="current-scan-time" id="currentScanTime">--:--:--</span>
                        <span class="current-scan-status" id="currentScanStatus">
                            <span class="status-icon">ğŸ“„</span>
                            <span class="status-text">Aktueller Scan</span>
                        </span>
                    </div>
                    <div class="current-scan-content" id="currentScanContent">Noch kein QR-Code gescannt</div>
                    <div class="current-scan-message" id="currentScanMessage">Scannen Sie einen QR-Code</div>
                </div>

                <!-- Erfolgreich gescannte Pakete - Tabellenansicht -->
                <div class="success-scans-table-container">
                    <table class="success-scans-table" id="successScansTable">
                        <thead>
                        <tr>
                            <th class="scan-time-col">Zeit</th>
                            <th class="user-col">Mitarbeiter</th>
                            <th class="auftrag-col">Auftrags-ID</th>
                            <th class="kunde-col">Kunden-ID</th>
                            <th class="paket-col">Paket-ID</th>
                        </tr>
                        </thead>
                        <tbody id="successScansTableBody">
                        <!-- Erfolgreiche Scans werden hier eingefÃ¼gt -->
                        </tbody>
                    </table>

                    <div class="empty-scans" id="emptySuccessScans">
                        <div class="empty-icon">ğŸ“¦</div>
                        <p>Noch keine Pakete erfolgreich gescannt</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Footer -->
<footer class="main-footer">
    <div class="footer-content">
        <div class="footer-left">
            <span id="instructionText">ğŸ’¡ RFID-Tag scannen = Anmelden â€¢ QR-Code scannen = Paket einlagern â€¢ Erneuter RFID-Scan = Session neu starten</span>
        </div>
        <div class="footer-right">
            <span id="versionText">v1.0.0</span>
            <span class="separator">â€¢</span>
            <span id="dateText">--.--.----</span>
        </div>
    </div>
</footer>

<!-- Benachrichtigungen -->
<div class="notifications" id="notifications"></div>

<!-- Error Modal -->
<div class="modal" id="errorModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <span class="icon">âš ï¸</span>
                Fehler
            </h3>
            <button class="modal-close" id="errorModalClose">âœ•</button>
        </div>
        <div class="modal-body">
            <div class="error-message" id="errorMessage"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" id="errorModalOk">OK</button>
        </div>
    </div>
</div>

<!-- Camera Permission Modal -->
<div class="modal" id="cameraPermissionModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <span class="icon">ğŸ“·</span>
                Kamera-Berechtigung
            </h3>
        </div>
        <div class="modal-body">
            <p>Die Anwendung benÃ¶tigt Zugriff auf Ihre Kamera fÃ¼r das QR-Code-Scanning.</p>
            <p>Bitte erlauben Sie den Kamera-Zugriff im nÃ¤chsten Dialog.</p>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" id="grantCameraPermission">Kamera erlauben</button>
            <button class="btn-secondary" id="cancelCameraPermission">Abbrechen</button>
        </div>
    </div>
</div>

<!-- User Logout Confirmation Modal -->
<div class="modal" id="logoutModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <span class="icon">ğŸ”“</span>
                Mitarbeiter abmelden
            </h3>
            <button class="modal-close" id="logoutModalClose">âœ•</button>
        </div>
        <div class="modal-body">
            <p>MÃ¶chten Sie <strong id="logoutUserName"></strong> wirklich abmelden?</p>
            <p class="modal-warning">Die Session wird beendet und alle ungespeicherten Daten gehen verloren.</p>
        </div>
        <div class="modal-footer">
            <button class="btn-danger" id="confirmLogout">Ja, abmelden</button>
            <button class="btn-secondary" id="cancelLogout">Abbrechen</button>
        </div>
    </div>
</div>

<!-- Session Restart Confirmation Modal -->
<div class="modal" id="sessionRestartModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <span class="icon">ğŸ”„</span>
                Session neu starten
            </h3>
            <button class="modal-close" id="sessionRestartModalClose">âœ•</button>
        </div>
        <div class="modal-body">
            <p>MÃ¶chten Sie die Session von <strong id="restartUserName"></strong> neu starten?</p>
            <p class="modal-info">Der Timer wird zurÃ¼ckgesetzt und die Session beginnt von vorne.</p>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" id="confirmSessionRestart">Ja, neu starten</button>
            <button class="btn-secondary" id="cancelSessionRestart">Abbrechen</button>
        </div>
    </div>
</div>

<script src="app.js"></script>
</body>
</html>